#!/bin/bash
# SPDX-License-Identifier: MIT-0

set -euxo pipefail

maybe_sudo=
if [[ "${EUID}" -ne 0 ]]; then
  maybe_sudo=sudo
fi

case "$OSTYPE" in
    darwin*)
    # Mac-specific installations
    brew install pipx
    ;;

    linux*)
    # Ubuntu-specific installations
    ${maybe_sudo} apt-get update
    ${maybe_sudo} apt-get install --no-install-recommends lsb-release

    if [[ "$(lsb_release -sc)" != 'jammy' ]]; then
      echo 'This script requires Ubuntu 22.04 (Jammy)' >&2
      exit 3
    fi

    ${maybe_sudo} apt-get install --no-install-recommends $(cat <<EOF
      libegl1
      libglib2.0-0
      libsm6
      libx11-6
      pipx
      python3
EOF
    )
    ;;
esac

# Install poetry and put it on PATH
pipx install poetry
pipx ensurepath
